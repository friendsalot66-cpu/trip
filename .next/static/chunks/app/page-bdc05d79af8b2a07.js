(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{8648:function(e,t,a){Promise.resolve().then(a.bind(a,3949))},3949:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return ex}});var s=a(7437),l=a(2265),r=a(166),n=a(795),i=a(3662),d=a(2660),o=a(5675),c=a(1341),m=a(1671),x=a(8842),p=a(9076),u=a(7782),h=a(4942),b=a(7625),g=a(8501),f=a(2883),y=a(6381),v=a(3247),j=a(1817),N=a(9397),w=a(2489),k=a(3774),D=a(2023),C=a(9892),S=a(8133),z=a(7662),I=a(1905),T=a(1723),Z=a(1804),E=a(100),P=a(8930);let _=e=>{let{place:t,index:a,onDelete:l,onClick:r,onEdit:n,onFindStopover:d,isOverlay:c,isDraggable:m=!1}=e,{attributes:x,listeners:p,setNodeRef:u,transform:h,transition:b,isDragging:g}=(0,i.nB)({id:t.id,data:{type:"Place",place:t},disabled:!m&&!c}),f={transform:C.ux.Transform.toString(h),transition:b,opacity:g?.3:1};return(0,s.jsxs)("div",{className:"relative",children:[t.travelTime&&(0,s.jsxs)("div",{className:"flex items-center gap-2 pl-9 pb-2 -mt-1 text-xs text-slate-400 font-medium",children:[(0,s.jsx)("div",{className:"w-0.5 h-3 bg-slate-200"}),(0,s.jsx)(z.Z,{size:10}),(0,s.jsx)("span",{children:t.travelTime})]}),(0,s.jsxs)("div",{ref:u,style:f,className:"\n          group relative flex items-start gap-3 p-3 mb-2 \n          bg-white rounded-lg shadow-sm \n          hover:shadow-md transition-all duration-200\n          border border-gray-100 ".concat((()=>{switch(t.type){case"flight":return"border-l-4 border-l-purple-400";case"hotel":return"border-l-4 border-l-amber-400";default:return"border-l-4 border-l-brand-400"}})(),"\n          ").concat(c?"shadow-xl scale-105 cursor-grabbing z-50 rotate-1":"","\n        "),children:[m&&(0,s.jsx)("div",{...x,...p,className:"mt-1 text-gray-300 cursor-grab active:cursor-grabbing hover:text-brand-500 touch-none transition-colors",children:(0,s.jsx)(I.Z,{size:16})}),(0,s.jsx)("div",{className:"mt-1 flex-shrink-0",children:(()=>{switch(t.type){case"flight":return(0,s.jsx)(y.Z,{size:16,className:"text-purple-600"});case"hotel":return(0,s.jsx)(S.Z,{size:16,className:"text-amber-600"});default:return(0,s.jsx)("span",{className:"flex items-center justify-center w-5 h-5 rounded-full bg-brand-100 text-brand-600 text-xs font-bold",children:null!=a?a:"•"})}})()}),(0,s.jsxs)("div",{className:"flex-1 cursor-pointer min-w-0",onClick:r,children:[(0,s.jsxs)("div",{className:"flex justify-between items-center gap-2",children:[(0,s.jsx)("h4",{className:"font-semibold text-gray-800 text-sm leading-tight truncate",children:t.name}),t.time&&(0,s.jsxs)("span",{className:"flex items-center gap-1 text-[10px] font-medium bg-gray-100 px-1.5 py-0.5 rounded text-gray-600 whitespace-nowrap",children:[(0,s.jsx)(T.Z,{size:10})," ",t.time]})]}),t.address&&(0,s.jsx)("p",{className:"text-xs text-gray-500 mt-1 flex items-center gap-1 truncate",children:(0,s.jsx)("span",{className:"truncate",children:t.address})}),t.remarks&&(0,s.jsx)("p",{className:"text-xs text-gray-600 mt-1.5 line-clamp-2",children:t.remarks}),t.expenses&&(0,s.jsxs)("div",{className:"flex items-center gap-1 mt-1.5 text-xs text-emerald-600 font-medium",children:[(0,s.jsx)(Z.Z,{size:10}),t.expenses.currency," ",t.expenses.amount]})]}),(0,s.jsxs)("div",{className:"flex flex-col items-center gap-1 pl-1 border-l border-gray-50 ml-1",children:[(0,s.jsx)("button",{onClick:e=>{e.stopPropagation(),n()},className:"text-gray-400 hover:text-blue-500 transition-colors p-1.5 hover:bg-blue-50 rounded",title:"Edit",children:(0,s.jsx)(o.Z,{size:14})}),(0,s.jsx)("button",{onClick:e=>{e.stopPropagation(),d()},className:"text-gray-400 hover:text-amber-500 transition-colors p-1.5 hover:bg-amber-50 rounded",title:"Find Stopover After",children:(0,s.jsx)(E.Z,{size:14})}),(0,s.jsx)("button",{onClick:e=>{e.stopPropagation(),l(t.id)},className:"text-gray-400 hover:text-red-500 transition-colors p-1.5 hover:bg-red-50 rounded",title:"Delete",children:(0,s.jsx)(P.Z,{size:14})})]})]})]})};async function F(e,t){let a=await fetch("/api/ai",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({task:e,payload:t})});if(!a.ok)throw Error((await a.json()).error||"API call for task '".concat(e,"' failed"));return a.json()}let O=async(e,t)=>{try{return(await F("findPlaces",{query:e,currentCenter:t})).candidates||[]}catch(e){return console.error("AI Search Error:",e),[]}},U=async(e,t)=>{throw console.warn("generateItineraryWithAI is not supported in this version."),Error("Generating a full itinerary with AI is not currently supported.")},M=async(e,t,a,s)=>{try{return(await F("optimizeItinerary",{currentItinerary:e,scope:t,activeDayId:a,constraints:s})).map(e=>({...e,places:e.places.map(e=>({...e,id:crypto.randomUUID(),type:e.type||"activity"}))}))}catch(e){throw console.error("AI Optimization Error:",e),e}},A=async e=>{try{let t=await F("parseItineraryFromText",{text:e});return t.days&&(t.days=t.days.map((e,t)=>({...e,dayId:e.dayId||"day-".concat(t+1),places:e.places.map(e=>({...e,id:crypto.randomUUID(),type:e.type||"activity"}))}))),t}catch(e){throw console.error("AI Parsing Error:",e),e}},R=async e=>{if(e.length<2)return e;try{let t=(await F("calculateTravelTimes",{places:e})).times||[];return e.map((e,a)=>({...e,travelTime:a>0&&t[a]?t[a]:void 0}))}catch(t){return console.error("Travel Time Est Error:",t),e}},L=async(e,t)=>{try{return(await F("getStopoverRecommendations",{from:e,to:t})).candidates||[]}catch(e){return console.error("Stopover Error:",e),[]}},G=(e,t)=>{let a="# ".concat(e,"\n\n");return t.forEach(e=>{a+="## ".concat(e.title," (").concat(e.date,")\n"),e.places.forEach((e,t)=>{let s=e.time?"**".concat(e.time,"** "):"",l=e.travelTime?"\n   *\uD83D\uDE97 Travel: ".concat(e.travelTime,"*"):"",r=e.expenses?"\n   *\uD83D\uDCB0 Expense: ".concat(e.expenses.currency," ").concat(e.expenses.amount,"*"):"";a+="".concat(t+1,". ").concat(s).concat(e.name," (").concat(e.type,")\n   ").concat(e.remarks||"").concat(l).concat(r,"\n\n")}),a+="---\n\n"}),a},J=e=>{var t,a;let{days:r,activeDayId:C,setActiveDayId:S,onAddPlace:z,onUpdatePlace:I,onDeletePlace:T,onPlaceClick:Z,onAIPlan:E,mapCenter:P,tripTitle:F,onUpdateTitle:M,isSaving:A=!1,onOptimize:R,onUndo:J,canUndo:B,isEditMode:q,onToggleEditMode:K,onUpdateDayTitle:X,onBack:H,onMoveDay:Y,onShowStopovers:V}=e,[W,Q]=(0,l.useState)(""),[$,ee]=(0,l.useState)(!1),[et,ea]=(0,l.useState)([]),[es,el]=(0,l.useState)(!1),[er,en]=(0,l.useState)(F||""),[ei,ed]=(0,l.useState)(!1),[eo,ec]=(0,l.useState)(""),[em,ex]=(0,l.useState)(!1),[ep,eu]=(0,l.useState)(!1),[eh,eb]=(0,l.useState)(""),[eg,ef]=(0,l.useState)(!1),[ey,ev]=(0,l.useState)("day"),[ej,eN]=(0,l.useState)(""),[ew,ek]=(0,l.useState)(!1),[eD,eC]=(0,l.useState)(!1),[eS,ez]=(0,l.useState)(null),[eI,eT]=(0,l.useState)({isOpen:!1,data:{}}),eZ=r.findIndex(e=>e.dayId===C),eE=eZ>=0?r[eZ]:null;(0,l.useEffect)(()=>{en(F||"")},[F]),(0,l.useEffect)(()=>{eE&&(ec(eE.title),ed(!1))},[C,r]);let{setNodeRef:eP}=(0,n.Zj)({id:C,data:{type:"Day",dayId:C}}),e_=e=>{e&&e.preventDefault(),er.trim()?M(er):en(F||""),el(!1)},eF=e=>{e&&e.preventDefault(),eo.trim()&&eE?X(C,eo):eE&&ec(eE.title),ed(!1)},eO=async e=>{if(e.preventDefault(),!W.trim())return;ee(!0),ea([]);let t=await O(W,P);ee(!1),t.length>0&&ea(t)},eU=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"activity";ea([]),Q(""),z({id:crypto.randomUUID(),name:e.name||"New Place",lat:e.lat||P.lat,lng:e.lng||P.lng,remarks:e.remarks||"",address:e.address,type:t,time:e.time}),V([])},eM=e=>{eT({isOpen:!0,data:{...e}})},eA=async()=>{if(eh.trim()){eu(!0);try{let e=await U(eh,r.length);e.length>0&&(E(e),ex(!1))}catch(e){alert("Failed to generate itinerary. Please try again.")}finally{eu(!1)}}},eR=async e=>{var t;let a=null!==(t=null==eE?void 0:eE.places.findIndex(t=>t.id===e.id))&&void 0!==t?t:-1;if(-1===a||!eE||a===eE.places.length-1){alert("Please select a place that is not the last one in the list to find a stopover.");return}let s=eE.places[a+1];ez(e.id);try{let t=await L(e,s);if(t.length>0){let e=t.map(e=>({id:crypto.randomUUID(),name:e.name||"Unknown",lat:e.lat||0,lng:e.lng||0,remarks:e.remarks||"",address:e.address,type:"activity"}));V(e)}else alert("No recommendations found.")}catch(e){console.error(e),alert("Error finding stopovers")}finally{ez(null)}},eL=e=>{if("json"===e){let e=new Blob([JSON.stringify(r,null,2)],{type:"application/json"}),t=URL.createObjectURL(e),a=document.createElement("a");a.href=t,a.download="".concat(F||"trip",".json"),a.click()}else if("md"===e){let e=new Blob([G(F||"Trip",r)],{type:"text/markdown"}),t=URL.createObjectURL(e),a=document.createElement("a");a.href=t,a.download="".concat(F||"trip",".md"),a.click()}else window.print();eC(!1)},eG=e=>{if(!eE)return;let t=eE.places.filter(e=>"flight"!==e.type).findIndex(t=>t.id===e);return -1!==t?t+1:void 0},eJ="overview"===C;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"print-only p-10 bg-white",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold mb-4",children:F}),r.map((e,t)=>(0,s.jsxs)("div",{className:"mb-8 break-inside-avoid",children:[(0,s.jsxs)("h2",{className:"text-xl font-bold border-b pb-2 mb-4 bg-gray-100 p-2 rounded",children:["Day ",t+1,": ",e.title," (",e.date,")"]}),(0,s.jsx)("ul",{className:"space-y-4",children:e.places.map((e,t)=>(0,s.jsxs)("li",{className:"flex gap-4 border-l-4 border-gray-300 pl-4 py-1",children:[(0,s.jsx)("div",{className:"font-bold text-gray-500 w-16",children:e.time||"--:--"}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"font-bold text-lg",children:[e.name," ",(0,s.jsx)("span",{className:"text-xs uppercase bg-gray-200 px-1 rounded",children:e.type})]}),(0,s.jsx)("div",{className:"text-gray-600",children:e.remarks}),e.expenses&&(0,s.jsxs)("div",{className:"text-sm text-gray-800 font-mono",children:["Cost: ",e.expenses.currency," ",e.expenses.amount]}),e.travelTime&&(0,s.jsxs)("div",{className:"text-xs text-gray-500 mt-1 italic",children:["\uD83D\uDE97 Travel: ",e.travelTime]})]})]},e.id))})]},e.dayId))]}),(0,s.jsxs)("div",{className:"flex flex-col h-full bg-slate-50 border-r border-slate-200 print:hidden sidebar-container",children:[(0,s.jsxs)("div",{className:"p-4 bg-white border-b border-slate-200 sidebar-header",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsxs)("div",{className:"flex flex-1 min-w-0 mr-4 items-center gap-2",children:[(0,s.jsx)("button",{onClick:H,className:"p-1.5 -ml-1.5 text-slate-400 hover:text-slate-700 hover:bg-slate-100 rounded-full transition-colors",children:(0,s.jsx)(d.Z,{size:20})}),(0,s.jsxs)("div",{className:"min-w-0",children:[(0,s.jsx)("h1",{className:"text-xs font-bold text-brand-600 flex items-center gap-1 uppercase tracking-wider mb-0.5",children:"TripPlanner"}),es?(0,s.jsx)("form",{onSubmit:e_,className:"flex items-center",children:(0,s.jsx)("input",{autoFocus:!0,type:"text",value:er,onChange:e=>en(e.target.value),onBlur:()=>e_(),className:"text-sm w-full border-b border-brand-500 outline-none pb-0.5 bg-transparent text-slate-900 font-bold"})}):(0,s.jsxs)("div",{onClick:()=>el(!0),className:"group flex items-center gap-2 cursor-pointer hover:bg-slate-50 rounded pl-1 py-0.5",children:[(0,s.jsx)("p",{className:"text-sm font-bold text-slate-900 truncate max-w-[150px]",children:F||"My Trip"}),(0,s.jsx)(o.Z,{size:12,className:"text-slate-400 opacity-0 group-hover:opacity-100 transition-opacity flex-shrink-0"}),(0,s.jsx)("div",{className:"flex items-center gap-1 ml-1 flex-shrink-0",children:A?(0,s.jsx)("span",{className:"text-[10px] text-brand-500 font-medium animate-pulse",children:(0,s.jsx)(c.Z,{size:10})}):(0,s.jsx)("span",{className:"text-[10px] text-slate-300 font-medium",children:(0,s.jsx)(m.Z,{size:10})})})]})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 flex-shrink-0",children:[(0,s.jsx)("button",{onClick:K,title:q?"Finish Reordering":"Reorder List",className:"p-1.5 rounded-full transition-colors ".concat(q?"bg-brand-100 text-brand-600":"text-slate-400 hover:text-slate-700 hover:bg-slate-100"),children:(0,s.jsx)(x.Z,{size:16})}),B&&(0,s.jsx)("button",{onClick:J,title:"Undo last change",className:"p-1.5 text-slate-400 hover:text-slate-700 hover:bg-slate-100 rounded-full transition-colors",children:(0,s.jsx)(p.Z,{size:16})}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("button",{onClick:()=>eC(!eD),className:"p-1.5 text-slate-400 hover:text-slate-700 hover:bg-slate-100 rounded-full transition-colors",children:(0,s.jsx)(u.Z,{size:16})}),eD&&(0,s.jsxs)("div",{className:"absolute right-0 top-full mt-2 w-48 bg-white rounded-xl shadow-xl border border-slate-100 z-50 py-1",children:[(0,s.jsxs)("button",{onClick:()=>eL("json"),className:"flex items-center gap-2 w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-slate-50",children:[(0,s.jsx)(h.Z,{size:14})," Export JSON"]}),(0,s.jsxs)("button",{onClick:()=>eL("md"),className:"flex items-center gap-2 w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-slate-50",children:[(0,s.jsx)(h.Z,{size:14})," Export Markdown"]}),(0,s.jsxs)("button",{onClick:()=>eL("print"),className:"flex items-center gap-2 w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-slate-50",children:[(0,s.jsx)(b.Z,{size:14})," Print / PDF"]})]})]})]})]}),(0,s.jsxs)("div",{className:"flex gap-2 overflow-x-auto pb-2 scrollbar-hide tabs-container",children:[(0,s.jsxs)("button",{onClick:()=>S("overview"),className:"flex-shrink-0 px-3 py-1.5 rounded-lg text-sm font-medium transition-all text-left min-w-[80px]\n                    ".concat("overview"===C?"bg-brand-600 text-white shadow-md":"bg-white text-slate-600 hover:bg-slate-100 border border-slate-200","\n                "),children:[(0,s.jsx)("div",{className:"text-[10px] opacity-80 uppercase tracking-wide",children:"Trip"}),(0,s.jsx)("div",{children:"Overview"})]}),r.map((e,t)=>(0,s.jsxs)("button",{onClick:()=>S(e.dayId),className:"\n                    flex-shrink-0 px-3 py-1.5 rounded-lg text-sm font-medium transition-all text-left min-w-[80px]\n                    ".concat(C===e.dayId?"bg-brand-600 text-white shadow-md":"bg-white text-slate-600 hover:bg-slate-100 border border-slate-200","\n                "),children:[(0,s.jsxs)("div",{className:"text-[10px] opacity-80 uppercase tracking-wide",children:["Day ",t+1]}),(0,s.jsx)("div",{children:e.date})]},e.dayId)),(0,s.jsx)("button",{onClick:()=>ek(!0),className:"flex-shrink-0 p-2 rounded-lg border border-dashed border-slate-300 text-slate-400 hover:text-brand-600 hover:border-brand-300 hover:bg-brand-50 transition-colors",title:"Manage Days",children:(0,s.jsx)(g.Z,{size:18})})]})]}),(0,s.jsx)("div",{className:"flex-1 overflow-y-auto p-4 relative",children:eJ?(0,s.jsxs)("div",{className:"text-center py-10",children:[(0,s.jsx)("h2",{className:"text-xl font-bold text-slate-800 mb-2",children:"Trip Overview"}),(0,s.jsx)("p",{className:"text-sm text-slate-500 mb-6",children:"Showing all locations on the map."}),(0,s.jsx)("div",{className:"space-y-4 max-w-sm mx-auto text-left",children:r.map((e,t)=>(0,s.jsxs)("div",{className:"bg-white p-4 rounded-xl border border-slate-200 shadow-sm cursor-pointer hover:border-brand-200 hover:shadow-md transition-all",onClick:()=>S(e.dayId),children:[(0,s.jsxs)("h4",{className:"font-bold text-slate-800",children:["Day ",t+1,": ",e.title]}),(0,s.jsxs)("p",{className:"text-xs text-slate-500 mt-1",children:[e.places.length," places • ",e.date]})]},e.dayId))})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[ei?(0,s.jsx)("form",{onSubmit:eF,className:"flex-1 mr-2",children:(0,s.jsx)("input",{autoFocus:!0,type:"text",value:eo,onChange:e=>ec(e.target.value),onBlur:()=>eF(),className:"w-full text-lg font-bold text-slate-800 border-b border-brand-500 outline-none bg-transparent"})}):(0,s.jsxs)("h2",{onClick:()=>ed(!0),className:"text-lg font-bold text-slate-800 flex items-center gap-2 cursor-pointer hover:bg-slate-50 px-1 -ml-1 rounded transition-colors group",children:[null==eE?void 0:eE.title,(0,s.jsx)(o.Z,{size:12,className:"text-slate-300 opacity-0 group-hover:opacity-100"})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsxs)("button",{onClick:()=>ef(!0),className:"flex items-center gap-1 text-xs font-medium text-amber-600 hover:text-amber-700 bg-amber-50 border border-amber-100 px-2 py-1 rounded hover:bg-amber-100 transition-colors",title:"Reorder places for best route",children:[(0,s.jsx)(f.Z,{size:14})," Optimize"]}),(0,s.jsxs)("button",{onClick:()=>eU({name:"Flight",remarks:"Flight details"},"flight"),className:"flex items-center gap-1 text-xs font-medium text-slate-600 hover:text-brand-600 bg-white border border-slate-200 px-2 py-1 rounded hover:bg-brand-50 transition-colors",children:[(0,s.jsx)(y.Z,{size:14})," Flight"]})]})]}),(0,s.jsxs)("form",{onSubmit:eO,className:"mb-6 relative",children:[(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("input",{type:"text",value:W,onChange:e=>Q(e.target.value),placeholder:"Find activity, hotel, or place...",className:"w-full pl-9 pr-4 py-2.5 rounded-xl border border-slate-200 focus:border-brand-500 focus:ring-2 focus:ring-brand-100 outline-none transition-all text-sm shadow-sm bg-white text-gray-900"}),(0,s.jsx)(v.Z,{className:"absolute left-3 top-3 text-slate-400",size:14}),(0,s.jsx)("button",{type:"submit",disabled:$||!W,className:"absolute right-2 top-2 p-1 bg-brand-50 text-brand-600 rounded hover:bg-brand-100 disabled:opacity-50 transition-colors",children:$?(0,s.jsx)(j.Z,{className:"animate-spin",size:14}):(0,s.jsx)(N.Z,{size:14})})]}),et.length>0&&(0,s.jsxs)("div",{className:"absolute top-full left-0 right-0 mt-1 bg-white rounded-xl shadow-xl border border-slate-100 z-50 overflow-hidden",children:[(0,s.jsxs)("div",{className:"p-2 bg-slate-50 text-xs font-semibold text-slate-500 border-b flex justify-between",children:[(0,s.jsx)("span",{children:"Select a location"}),(0,s.jsx)("button",{onClick:()=>ea([]),children:(0,s.jsx)(w.Z,{size:12})})]}),(0,s.jsx)("ul",{className:"max-h-60 overflow-y-auto",children:et.map((e,t)=>(0,s.jsx)("li",{children:(0,s.jsxs)("button",{onClick:()=>eU(e,"activity"),className:"w-full text-left p-3 hover:bg-brand-50 transition-colors border-b border-slate-50 last:border-0",children:[(0,s.jsx)("div",{className:"font-medium text-slate-800 text-sm",children:e.name}),(0,s.jsx)("div",{className:"text-xs text-slate-500 truncate",children:e.address})]})},t))})]})]}),(0,s.jsx)("div",{ref:eP,className:"space-y-3 min-h-[200px] pb-20",children:(0,s.jsxs)(i.Fo,{items:(null==eE?void 0:eE.places.map(e=>e.id))||[],strategy:i.qw,children:[null==eE?void 0:eE.places.map((e,t)=>(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(_,{index:"flight"!==e.type?eG(e.id):void 0,place:e,onDelete:e=>T(C,e),onClick:()=>Z(e),onEdit:()=>eM(e),onFindStopover:()=>eR(e),isDraggable:q}),eS===e.id&&(0,s.jsxs)("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-20 bg-black/70 text-white text-xs px-3 py-1.5 rounded-full flex items-center gap-2",children:[(0,s.jsx)(j.Z,{size:12,className:"animate-spin"})," Finding stops..."]})]},e.id)),(null==eE?void 0:eE.places.length)===0&&(0,s.jsxs)("div",{className:"text-center py-10 text-slate-400 border-2 border-dashed border-slate-200 rounded-xl",children:[(0,s.jsx)(k.Z,{className:"mx-auto mb-2 opacity-50"}),(0,s.jsx)("p",{className:"text-sm",children:"Plan your day here"})]})]})})]})}),eI.isOpen&&(0,s.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4 backdrop-blur-sm",children:(0,s.jsxs)("div",{className:"bg-white rounded-2xl w-full max-w-sm p-5 shadow-2xl animate-in fade-in zoom-in-95 duration-200",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4 border-b pb-3",children:[(0,s.jsx)("h3",{className:"font-bold text-gray-800",children:"Edit Details"}),(0,s.jsx)("button",{onClick:()=>eT({...eI,isOpen:!1}),children:(0,s.jsx)(w.Z,{size:18,className:"text-gray-400"})})]}),(0,s.jsxs)("form",{onSubmit:e=>{if(e.preventDefault(),!eI.data.name||!eI.data.id)return;let t={...eI.data};t.expenses&&"string"==typeof t.expenses.amount&&(t.expenses.amount=parseFloat(t.expenses.amount)),I(C,t),eT({isOpen:!1,data:{}})},className:"space-y-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-xs font-semibold text-gray-500 mb-1",children:"Place Name"}),(0,s.jsx)("input",{type:"text",required:!0,className:"w-full text-sm p-2 border rounded-lg focus:ring-2 focus:ring-brand-100 outline-none bg-white text-gray-900",value:eI.data.name,onChange:e=>eT(t=>({...t,data:{...t.data,name:e.target.value}}))})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-xs font-semibold text-gray-500 mb-1",children:"Type"}),(0,s.jsxs)("select",{className:"w-full text-sm p-2 border rounded-lg focus:ring-2 focus:ring-brand-100 outline-none bg-white text-gray-900",value:eI.data.type,onChange:e=>eT(t=>({...t,data:{...t.data,type:e.target.value}})),children:[(0,s.jsx)("option",{value:"activity",children:"Activity"}),(0,s.jsx)("option",{value:"hotel",children:"Hotel"}),(0,s.jsx)("option",{value:"flight",children:"Flight"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-xs font-semibold text-gray-500 mb-1",children:"Time"}),(0,s.jsx)("input",{type:"time",className:"w-full text-sm p-2 border rounded-lg focus:ring-2 focus:ring-brand-100 outline-none bg-white text-gray-900",value:eI.data.time||"",onChange:e=>eT(t=>({...t,data:{...t.data,time:e.target.value}}))})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-xs font-semibold text-gray-500 mb-1",children:"Currency"}),(0,s.jsx)("input",{type:"text",placeholder:"TWD",className:"w-full text-sm p-2 border rounded-lg focus:ring-2 focus:ring-brand-100 outline-none bg-white text-gray-900",value:(null===(t=eI.data.expenses)||void 0===t?void 0:t.currency)||"TWD",onChange:e=>eT(t=>{var a;return{...t,data:{...t.data,expenses:{amount:(null===(a=t.data.expenses)||void 0===a?void 0:a.amount)||0,currency:e.target.value}}}})})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-xs font-semibold text-gray-500 mb-1",children:"Cost"}),(0,s.jsx)("input",{type:"number",placeholder:"0",className:"w-full text-sm p-2 border rounded-lg focus:ring-2 focus:ring-brand-100 outline-none bg-white text-gray-900",value:(null===(a=eI.data.expenses)||void 0===a?void 0:a.amount)||"",onChange:e=>eT(t=>{var a;return{...t,data:{...t.data,expenses:{currency:(null===(a=t.data.expenses)||void 0===a?void 0:a.currency)||"TWD",amount:parseFloat(e.target.value)}}}})})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-xs font-semibold text-gray-500 mb-1",children:"Remarks"}),(0,s.jsx)("textarea",{className:"w-full text-sm p-2 border rounded-lg focus:ring-2 focus:ring-brand-100 outline-none h-20 resize-none bg-white text-gray-900",placeholder:"Add notes, booking ref, etc.",value:eI.data.remarks||"",onChange:e=>eT(t=>({...t,data:{...t.data,remarks:e.target.value}}))})]}),(0,s.jsx)("button",{type:"submit",className:"w-full bg-slate-900 text-white py-2.5 rounded-xl font-medium text-sm hover:bg-black transition-colors",children:"Save Changes"})]})]})}),ew&&(0,s.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4 backdrop-blur-sm",children:(0,s.jsxs)("div",{className:"bg-white rounded-2xl w-full max-w-sm p-5 shadow-2xl",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4 border-b pb-3",children:[(0,s.jsx)("h3",{className:"text-lg font-bold text-slate-800",children:"Manage Days"}),(0,s.jsx)("button",{onClick:()=>ek(!1),children:(0,s.jsx)(w.Z,{size:18,className:"text-gray-400"})})]}),(0,s.jsx)("div",{className:"space-y-2 max-h-80 overflow-y-auto",children:r.map((e,t)=>(0,s.jsxs)("div",{className:"flex items-center justify-between p-3 bg-slate-50 rounded-lg border border-slate-100",children:[(0,s.jsxs)("span",{className:"font-medium text-sm text-slate-800",children:["Day ",t+1,": ",e.date]}),(0,s.jsx)("div",{className:"flex gap-1",children:(0,s.jsx)("button",{disabled:0===t,onClick:()=>Y(t,t-1),className:"p-1 text-slate-400 hover:text-brand-600 disabled:opacity-30",children:(0,s.jsx)(x.Z,{size:16})})})]},e.dayId))})]})}),em&&(0,s.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4 backdrop-blur-sm",children:(0,s.jsxs)("div",{className:"bg-white rounded-2xl w-full max-w-md p-6 shadow-2xl",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsxs)("h3",{className:"text-xl font-bold flex items-center gap-2",children:[(0,s.jsx)(D.Z,{className:"text-purple-600"}),"AI Planner"]}),(0,s.jsx)("button",{onClick:()=>ex(!1),className:"text-gray-400 hover:text-gray-600",children:"✕"})]}),(0,s.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:"Use AI Thinking Mode to generate a complete itinerary."}),(0,s.jsx)("textarea",{value:eh,onChange:e=>eb(e.target.value),placeholder:"E.g., Plan a 3-day trip to Kyoto for a food lover focusing on traditional markets and temples.",className:"w-full h-32 p-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-200 outline-none text-sm mb-4 resize-none"}),(0,s.jsx)("button",{onClick:eA,disabled:ep||!eh,className:"w-full py-3 bg-purple-600 hover:bg-purple-700 text-white rounded-xl font-semibold transition-all disabled:opacity-50 flex justify-center items-center gap-2",children:ep?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(j.Z,{className:"animate-spin",size:18}),"Thinking..."]}):"Generate Itinerary"})]})}),eg&&(0,s.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4 backdrop-blur-sm",children:(0,s.jsxs)("div",{className:"bg-white rounded-2xl w-full max-w-sm p-5 shadow-2xl",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4 border-b pb-3",children:[(0,s.jsxs)("h3",{className:"text-lg font-bold flex items-center gap-2 text-amber-600",children:[(0,s.jsx)(f.Z,{size:20}),"Optimize Route"]}),(0,s.jsx)("button",{onClick:()=>ef(!1),children:(0,s.jsx)(w.Z,{size:18,className:"text-gray-400"})})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-xs font-semibold text-gray-500 mb-2",children:"Scope"}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("button",{onClick:()=>ev("day"),className:"flex-1 py-2 text-sm rounded-lg border transition-all ".concat("day"===ey?"bg-amber-100 border-amber-300 text-amber-800 font-medium":"bg-white border-gray-200 text-gray-600"),children:"Current Day"}),(0,s.jsx)("button",{onClick:()=>ev("trip"),className:"flex-1 py-2 text-sm rounded-lg border transition-all ".concat("trip"===ey?"bg-amber-100 border-amber-300 text-amber-800 font-medium":"bg-white border-gray-200 text-gray-600"),children:"Whole Trip"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-xs font-semibold text-gray-500 mb-2",children:"Constraints / Preferences"}),(0,s.jsx)("textarea",{className:"w-full text-sm p-3 border rounded-xl focus:ring-2 focus:ring-amber-200 outline-none h-24 resize-none bg-slate-50 text-gray-900",placeholder:"E.g., 'Minimize walking', 'Start after 10am', 'Group museums together'",value:ej,onChange:e=>eN(e.target.value)})]}),(0,s.jsxs)("button",{onClick:()=>{R(ey,ej),ef(!1),eN("")},className:"w-full bg-amber-600 text-white py-2.5 rounded-xl font-bold hover:bg-amber-700 transition-colors flex items-center justify-center gap-2",children:[(0,s.jsx)(f.Z,{size:16})," Run Optimization"]})]})]})})]})]})};var B=a(9322),q=a(91),K=a(3581),X=a(1047),H=a(6858);let Y=e=>{let{trips:t,onCreateNew:a,onSelectTrip:r,onDeleteTrip:n,onImportDemo:i,onUploadCover:d,isLoading:o,isConnected:c}=e,[x,p]=(0,l.useState)(null),[u,h]=(0,l.useState)(null),b=(0,l.useRef)(null),[g,f]=(0,l.useState)(null),y=async e=>{var t;let a=null===(t=e.target.files)||void 0===t?void 0:t[0];if(a&&g){h(g);try{await d(g,a)}catch(e){alert("Failed to upload image")}finally{h(null),f(null),b.current&&(b.current.value="")}}},v=e=>{var t;f(e),null===(t=b.current)||void 0===t||t.click()};return(0,s.jsx)("div",{className:"min-h-screen bg-slate-50 p-6 md:p-10",children:(0,s.jsxs)("div",{className:"max-w-6xl mx-auto",children:[(0,s.jsx)("input",{type:"file",ref:b,className:"hidden",accept:"image/*",onChange:y}),(0,s.jsxs)("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-slate-900",children:"My Trips"}),(0,s.jsx)("p",{className:"text-slate-500 mt-1",children:"Manage your travel itineraries"})]}),(0,s.jsxs)("div",{className:"flex gap-3",children:[(0,s.jsxs)("button",{onClick:i,className:"flex items-center gap-2 bg-purple-100 text-purple-700 px-5 py-2.5 rounded-xl font-medium hover:bg-purple-200 transition-colors",title:"Instantly load the Taipei 4D3N plan",children:[(0,s.jsx)(D.Z,{size:18}),"Load Taipei Demo"]}),(0,s.jsxs)("button",{onClick:a,className:"flex items-center gap-2 bg-brand-600 text-white px-5 py-2.5 rounded-xl font-medium hover:bg-brand-700 transition-colors shadow-lg shadow-brand-200",children:[(0,s.jsx)(N.Z,{size:18}),"Create New Trip"]})]})]}),c?(0,s.jsxs)("div",{className:"mb-6 bg-emerald-50 border border-emerald-200 rounded-xl p-3 flex items-center gap-2 max-w-fit",children:[(0,s.jsx)(m.Z,{className:"text-emerald-600 shrink-0",size:16}),(0,s.jsx)("span",{className:"text-xs font-medium text-emerald-800",children:"Connected to Database"})]}):(0,s.jsxs)("div",{className:"mb-6 bg-amber-50 border border-amber-200 rounded-xl p-4 flex items-start gap-3",children:[(0,s.jsx)(B.Z,{className:"text-amber-600 shrink-0 mt-0.5",size:20}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"font-semibold text-amber-800 text-sm",children:"Supabase Not Connected"}),(0,s.jsxs)("p",{className:"text-xs text-amber-700 mt-1",children:["Running in ",(0,s.jsx)("strong",{children:"Memory Mode"}),". Your trips will not be saved after you reload the page. To persist data, set ",(0,s.jsx)("code",{children:"SUPABASE_URL"})," and ",(0,s.jsx)("code",{children:"SUPABASE_KEY"})," in your environment variables."]})]})]}),o?(0,s.jsx)("div",{className:"flex justify-center py-20",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-brand-600"})}):0===t.length?(0,s.jsxs)("div",{className:"text-center py-20 bg-white rounded-3xl border border-dashed border-slate-200",children:[(0,s.jsx)("div",{className:"bg-slate-50 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,s.jsx)(k.Z,{className:"text-slate-400",size:32})}),(0,s.jsx)("h3",{className:"text-lg font-medium text-slate-800",children:"No trips yet"}),(0,s.jsx)("p",{className:"text-slate-500 mb-6 max-w-sm mx-auto",children:"Start by creating your first adventure plan."}),(0,s.jsxs)("div",{className:"flex justify-center gap-3",children:[(0,s.jsx)("button",{onClick:i,className:"text-purple-600 font-medium hover:underline",children:"Load Demo"}),(0,s.jsx)("span",{className:"text-slate-300",children:"|"}),(0,s.jsx)("button",{onClick:a,className:"text-brand-600 font-medium hover:underline",children:"Create New"})]})]}):(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:t.map(e=>{var t;return(0,s.jsxs)("div",{onClick:()=>r(e),className:"group bg-white rounded-2xl border border-slate-200 overflow-hidden hover:shadow-xl transition-all cursor-pointer relative flex flex-col h-full",children:[(0,s.jsxs)("div",{className:"h-40 relative overflow-hidden bg-slate-200 group-header",children:[e.cover_image_url?(0,s.jsx)("img",{src:e.cover_image_url,alt:e.title,className:"w-full h-full object-cover transition-transform duration-700 group-hover:scale-110"}):(0,s.jsx)("div",{className:"w-full h-full bg-gradient-to-r from-brand-500 to-purple-600"}),(0,s.jsx)("div",{className:"absolute inset-0 bg-black/10 group-hover:bg-black/20 transition-colors"}),c&&(0,s.jsx)("div",{className:"absolute top-3 left-3 bg-black/30 backdrop-blur-md p-1.5 rounded-full z-10",title:"Synced to Database",children:(0,s.jsx)(q.Z,{size:12,className:"text-white/90"})}),(0,s.jsx)("div",{className:"absolute bottom-3 right-3 z-30 opacity-0 group-hover:opacity-100 transition-opacity",onClick:t=>{t.stopPropagation(),t.preventDefault(),v(e.id)},children:(0,s.jsx)("button",{className:"p-2 bg-black/40 hover:bg-black/60 backdrop-blur-md rounded-full text-white transition-all",children:u===e.id?(0,s.jsx)(j.Z,{size:16,className:"animate-spin"}):(0,s.jsx)(K.Z,{size:16})})}),(0,s.jsx)("div",{className:"absolute top-3 right-3 z-30",onClick:e=>{e.stopPropagation(),e.preventDefault()},children:x===e.id?(0,s.jsx)("button",{onClick:t=>{t.stopPropagation(),n(e.id),p(null)},className:"px-3 py-1.5 bg-red-600 text-white text-xs font-bold rounded-lg shadow-lg hover:bg-red-700 transition-all pointer-events-auto",children:"Confirm?"}):(0,s.jsx)("button",{onClick:t=>{t.stopPropagation(),p(e.id),setTimeout(()=>p(null),3e3)},className:"p-2 bg-black/20 hover:bg-red-500/80 backdrop-blur-md rounded-full text-white transition-all pointer-events-auto cursor-pointer",title:"Delete Trip",children:(0,s.jsx)(P.Z,{size:16})})})]}),(0,s.jsxs)("div",{className:"p-5 flex-1 flex flex-col",children:[(0,s.jsx)("h3",{className:"text-lg font-bold text-slate-800 mb-2 truncate",title:e.title,children:e.title}),(0,s.jsxs)("div",{className:"flex items-center gap-2 text-sm text-slate-500 mb-4",children:[(0,s.jsx)(X.Z,{size:14}),(0,s.jsxs)("span",{children:[new Date(e.start_date).toLocaleDateString()," - ",new Date(e.end_date).toLocaleDateString()]})]}),(0,s.jsxs)("div",{className:"mt-auto flex justify-between items-center pt-4 border-t border-slate-50",children:[(0,s.jsxs)("span",{className:"text-xs font-medium text-brand-600 bg-brand-50 px-2 py-1 rounded-md",children:[(null===(t=e.itinerary)||void 0===t?void 0:t.length)||0," Days"]}),(0,s.jsxs)("div",{className:"flex items-center gap-1 text-slate-400 text-sm group-hover:text-brand-600 transition-colors",children:["Open ",(0,s.jsx)(H.Z,{size:14})]})]})]})]},e.id)})})]})})};var V=a(7586),W=a(2048),Q=a(4194);let $="https://fmazlncxcmsredrxygha.supabase.co",ee="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZtYXpsbmN4Y21zcmVkcnh5Z2hhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ2ODkzODksImV4cCI6MjA4MDI2NTM4OX0.1FEZCmpvPPdnn-_PNbivLywiUivk62CEMn2uvSxusF8",et=(0,Q.eI)($,ee),ea=()=>!!$&&!!ee,es=async()=>{if(!ea())return[];let{data:e,error:t}=await et.from("trips").select("*").order("created_at",{ascending:!1});return t?(console.error("Error fetching trips:",t),[]):(e||[]).map(e=>({id:e.id,created_at:e.created_at,destination:e.destination||"Unknown Destination",start_date:e.start_date||new Date().toISOString(),end_date:e.end_date||new Date().toISOString(),title:e.title||"Untitled Trip",itinerary:e.itinerary||[],cover_image_url:e.cover_image_url}))},el=async(e,t,a,s)=>{if(!ea())return console.warn("Supabase not configured. Using mock storage (memory only)."),{id:crypto.randomUUID(),destination:e,start_date:t,end_date:a,title:"".concat(e," Trip"),itinerary:s};let{data:l,error:r}=await et.from("trips").insert([{destination:e,start_date:t,end_date:a,title:"".concat(e," Trip"),itinerary:s}]).select().single();if(r)throw console.error("Error creating trip:",r),r;return l?{id:l.id,created_at:l.created_at,destination:l.destination||e,start_date:l.start_date||t,end_date:l.end_date||a,title:l.title||"".concat(e," Trip"),itinerary:l.itinerary||s,cover_image_url:l.cover_image_url}:null},er=async(e,t)=>{if(!ea())return;let{error:a}=await et.from("trips").update({itinerary:t}).eq("id",e);if(a)throw console.error("Error updating itinerary:",a),a},en=async(e,t)=>{if(!ea())return;let{error:a}=await et.from("trips").update({title:t}).eq("id",e);if(a)throw console.error("Error updating title:",a),a},ei=async(e,t)=>{if(!ea())return null;let a=t.name.split(".").pop(),s="".concat(e,"-").concat(Math.random(),".").concat(a),l="".concat(s),{error:r}=await et.storage.from("trip-covers").upload(l,t);if(r)return console.error("Error uploading image:",r),null;let{data:n}=et.storage.from("trip-covers").getPublicUrl(l),i=n.publicUrl,{error:d}=await et.from("trips").update({cover_image_url:i}).eq("id",e);return d?(console.error("Error updating trip with image URL:",d),null):i},ed=async e=>{if(!ea())return;let{error:t}=await et.from("trips").delete().eq("id",e);if(t)throw console.error("Error deleting trip:",t),t},eo=[25.033,121.5654],ec=(0,r.default)(()=>Promise.all([a.e(212),a.e(565)]).then(a.bind(a,1565)).then(e=>e.MapComponent),{loadableGenerated:{webpack:()=>[1565]},ssr:!1,loading:()=>(0,s.jsx)("div",{className:"flex items-center justify-center h-full bg-slate-200",children:(0,s.jsx)(j.Z,{className:"animate-spin text-slate-500",size:48})})}),em=[{dayId:"day-1",title:"Day 1 12/18(四) 中山→華山→信義",date:"2024-12-18",places:[{id:"tpe-flight-1",name:"CX564 HKG→TPE",lat:25.0797,lng:121.2342,remarks:"08:30 HKG → 10:15 TPE",type:"flight",time:"08:30"},{id:"tpe-food-1",name:"軟食力 行天宮店",lat:25.063,lng:121.533,remarks:"蛋餅 4.5⭐ (14:00關)",type:"activity",time:"10:15-12:00"},{id:"tpe-hotel-1",name:"慕舍酒店 (Hotel Mvsa)",lat:25.0485,lng:121.536,remarks:"Check-in / 寄行李",type:"hotel",time:"12:15-13:00"},{id:"tpe-spot-1",name:"華山1914文化創意產業園區",lat:25.0441,lng:121.5293,remarks:"逛展覽/文創",type:"activity",time:"13:30-15:30"},{id:"tpe-cafe-1",name:"興波咖啡 Simple Kaffa",lat:25.0445,lng:121.529,remarks:"華山旗艦店 (4.7⭐)",type:"activity",time:"15:45-16:30"},{id:"tpe-spot-2",name:"Pok\xe9mon Center Taipei",lat:25.0355,lng:121.566,remarks:"信義A11 3F",type:"activity",time:"17:00-18:30"},{id:"tpe-food-2",name:"立志壽司",lat:25.0335,lng:121.5645,remarks:"訂位 18:30",type:"activity",time:"18:30"},{id:"tpe-spot-3",name:"臨江街觀光夜市",lat:25.0305,lng:121.554,remarks:"通化夜市",type:"activity",time:"19:30-22:00"},{id:"tpe-hotel-back-1",name:"回慕舍酒店",lat:25.0485,lng:121.536,remarks:"休息",type:"hotel",time:"22:30"}]},{dayId:"day-2",title:"Day 2 12/19(五) 北投溫泉",date:"2024-12-19",places:[{id:"tpe-food-3",name:"慕舍酒店早餐",lat:25.0485,lng:121.536,remarks:"米其林早餐",type:"activity",time:"08:00-10:30"},{id:"tpe-transport-1",name:"前往新北投站",lat:25.1369,lng:121.5064,remarks:"捷運紅線 (約40分)",type:"activity",time:"10:30-11:10"},{id:"tpe-hotel-2",name:"麗禧溫泉酒店",lat:25.136,lng:121.515,remarks:"Check-in / 寄行李",type:"hotel",time:"11:15"},{id:"tpe-spot-4",name:"地熱谷",lat:25.138,lng:121.5115,remarks:"參觀",type:"activity",time:"11:45"},{id:"tpe-food-4",name:"北投炸蛋蔥油餅 & 高記茶莊",lat:25.1325,lng:121.502,remarks:"北投中繼市場 (4.6⭐)",type:"activity",time:"12:30-13:15"},{id:"tpe-spot-5",name:"麗禧私人湯屋",lat:25.136,lng:121.515,remarks:"溫泉 3小時",type:"activity",time:"14:00-17:30"},{id:"tpe-food-5",name:"雍翠庭",lat:25.136,lng:121.515,remarks:"酒店晚餐 (4.5⭐)",type:"activity",time:"18:00"}]},{dayId:"day-3",title:"Day 3 12/20(六) 西門町火鍋",date:"2024-12-20",places:[{id:"tpe-hotel-out-2",name:"麗禧酒店 Checkout",lat:25.136,lng:121.515,remarks:"接駁車去捷運",type:"activity",time:"11:00"},{id:"tpe-hotel-3",name:"路徒Plus主題館",lat:25.045,lng:121.512,remarks:"台北車站附近 (寄行李)",type:"hotel",time:"11:45"},{id:"tpe-food-6",name:"加分100%浜中特選昆布鍋物",lat:25.0435,lng:121.507,remarks:"西門店 (義式白醬鍋 4.5⭐)",type:"activity",time:"13:00"},{id:"tpe-spot-6",name:"西門町商圈",lat:25.0425,lng:121.508,remarks:"Donki / 誠品",type:"activity",time:"14:30-17:00"},{id:"tpe-spot-7",name:"南機場夜市",lat:25.0295,lng:121.505,remarks:"米其林推薦 (QQ球/花生捲冰淇淋)",type:"activity",time:"17:30-21:00"},{id:"tpe-spot-8",name:"熊嗨星樂園",lat:25.046,lng:121.516,remarks:"夾娃娃 (站前大亞B1)",type:"activity",time:"21:30"},{id:"tpe-hotel-back-3",name:"回路徒Plus",lat:25.045,lng:121.512,remarks:"休息",type:"hotel",time:"22:30"}]},{dayId:"day-4",title:"Day 4 12/21(日) 購物返程",date:"2024-12-21",places:[{id:"tpe-food-7",name:"蜂大咖啡",lat:25.042,lng:121.506,remarks:"合桃酥 (4.6⭐)",type:"activity",time:"10:00"},{id:"tpe-food-8",name:"老山東牛肉麵",lat:25.044,lng:121.5065,remarks:"萬年大樓B1",type:"activity",time:"11:00"},{id:"tpe-food-9",name:"如邑堂餅家",lat:25.0465,lng:121.511,remarks:"開封店 (買手信)",type:"activity",time:"12:00"},{id:"tpe-spot-9",name:"赤峰街",lat:25.055,lng:121.52,remarks:"文青小店 (中山站)",type:"activity",time:"13:00-14:30"},{id:"tpe-spot-10",name:"大稻埕碼頭",lat:25.057,lng:121.507,remarks:"貨櫃市集 / 灑白甜麻糬",type:"activity",time:"14:45-15:45"},{id:"tpe-transport-2",name:"前往機場",lat:25.049,lng:121.513,remarks:"回飯店取行李 -> 機捷",type:"activity",time:"16:00-17:00"},{id:"tpe-flight-2",name:"CX565 TPE→HKG",lat:25.0797,lng:121.2342,remarks:"19:30 TPE → 21:30 HKG",type:"flight",time:"19:30"}]}];function ex(){let[e,t]=(0,l.useState)("dashboard"),[a,r]=(0,l.useState)("list"),[d,o]=(0,l.useState)(""),[c,m]=(0,l.useState)(null),[x,p]=(0,l.useState)(eo),[u,h]=(0,l.useState)(null),[b,g]=(0,l.useState)([]),[f,y]=(0,l.useState)({destination:"",startDate:"",endDate:""}),[v,N]=(0,l.useState)(null),[w,C]=(0,l.useState)("My Trip"),[S,z]=(0,l.useState)([]),[I,T]=(0,l.useState)(!1),[Z,E]=(0,l.useState)(!1),[P,_]=(0,l.useState)([]),[F,O]=(0,l.useState)(!1),[U,L]=(0,l.useState)("manual"),[G,B]=(0,l.useState)(""),[q,K]=(0,l.useState)(!1),[X,H]=(0,l.useState)(!1),[Q,$]=(0,l.useState)([]),ee=ea(),et=async()=>{O(!0),_(await es()),O(!1)};(0,l.useEffect)(()=>{et()},[]),(0,l.useEffect)(()=>{if("planner"===e&&v&&b.length>0){E(!0);let e=setTimeout(async()=>{await er(v,b),E(!1)},2e3);return()=>clearTimeout(e)}},[b,v,e]),(0,l.useEffect)(()=>{if("planner"!==e||0===b.length)return;let t=setTimeout(async()=>{if(d&&"overview"!==d){let e=b.findIndex(e=>e.dayId===d);if(-1===e)return;let t=b[e];if(t.places.length>1){let a=await R(t.places);JSON.stringify(a)!==JSON.stringify(t.places)&&g(s=>{let l=[...s];return l[e]={...t,places:a},l})}}},2e3);return()=>clearTimeout(t)},[b,d,e]);let ex=(0,n.Dy)((0,n.VT)(n.we),(0,n.VT)(n.Lg,{coordinateGetter:i.is})),ep=async e=>{if(e.preventDefault(),"ai"===U&&G.trim()){await eu();return}let a=new Date(f.startDate),s=Array.from({length:Math.ceil((new Date(f.endDate).getTime()-a.getTime())/864e5)+1},(e,t)=>{let s=new Date(a);return s.setDate(a.getDate()+t),{dayId:"day-".concat(t+1),title:"Day ".concat(t+1),date:s.toISOString().split("T")[0],places:[]}});g(s),o(s[0].dayId);let l=await el(f.destination,f.startDate,f.endDate,s);l&&(N(l.id),C(l.title),_([l,...P])),t("planner"),r("list")},eu=async()=>{K(!0);try{var e;let a=await A(G);g(a.days),y({destination:a.destination,startDate:a.startDate,endDate:a.endDate}),o((null===(e=a.days[0])||void 0===e?void 0:e.dayId)||"");let s=await el(a.destination,a.startDate,a.endDate,a.days);s&&(N(s.id),C(s.title),_([s,...P])),t("planner"),r("list")}catch(e){alert("Failed to parse itinerary. The AI couldn't understand the format. Please try rephrasing or use manual mode.")}finally{K(!1)}},eh=async()=>{K(!0);let e="Taipei",a="2024-12-18",s="2024-12-21";g(em),y({destination:e,startDate:a,endDate:s}),o(em[0].dayId);let l=await el(e,a,s,em);l&&(await en(l.id,"\uD83C\uDDF9\uD83C\uDDFC 台北4日3夜美食之旅"),l.title="\uD83C\uDDF9\uD83C\uDDFC 台北4日3夜美食之旅",N(l.id),C(l.title),_([l,...P])),K(!1),t("planner"),r("list")},eb=async e=>{_(t=>t.filter(t=>t.id!==e));try{await ed(e)}catch(e){console.error("Failed to delete trip, reverting UI",e),alert("Failed to delete trip from database."),et()}},eg=async(e,t)=>{let a=await ei(e,t);a&&_(t=>t.map(t=>t.id===e?{...t,cover_image_url:a}:t))},ef=async e=>{C(e),v&&(await en(v,e),_(t=>t.map(t=>t.id===v?{...t,title:e}:t)))},ey=()=>{let e=JSON.parse(JSON.stringify(b));z(t=>[...t.slice(-9),e])},ev=async(e,t)=>{ey(),H(!0);try{let a=await M(b,e,d,t);g(a)}catch(e){alert("Optimization failed. Please try again.")}finally{H(!1)}};if("dashboard"===e)return(0,s.jsxs)(s.Fragment,{children:[q&&(0,s.jsxs)("div",{className:"fixed inset-0 bg-black/50 z-[60] flex flex-col items-center justify-center text-white backdrop-blur-sm",children:[(0,s.jsx)(j.Z,{className:"animate-spin mb-3",size:48}),(0,s.jsx)("h3",{className:"text-xl font-bold",children:"Creating your Trip..."})]}),(0,s.jsx)(Y,{trips:P,onCreateNew:()=>t("create"),onSelectTrip:e=>{var a;g(e.itinerary),y({destination:e.destination,startDate:e.start_date,endDate:e.end_date}),N(e.id),C(e.title),o((null===(a=e.itinerary[0])||void 0===a?void 0:a.dayId)||""),t("planner"),r("list")},onDeleteTrip:eb,onImportDemo:eh,onUploadCover:eg,isLoading:F,isConnected:ee})]});if("create"===e)return(0,s.jsx)("div",{className:"min-h-screen bg-slate-50 flex items-center justify-center p-4",children:(0,s.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl w-full max-w-lg p-8",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-slate-900",children:"Plan a New Trip"}),(0,s.jsx)("button",{onClick:()=>t("dashboard"),className:"text-slate-400 hover:text-slate-600",children:"✕"})]}),(0,s.jsxs)("div",{className:"flex p-1 bg-slate-100 rounded-lg mb-6",children:[(0,s.jsx)("button",{onClick:()=>L("manual"),className:"flex-1 py-2 text-sm font-medium rounded-md transition-all ".concat("manual"===U?"bg-white text-slate-900 shadow-sm":"text-slate-500 hover:text-slate-700"),children:"Manual Input"}),(0,s.jsxs)("button",{onClick:()=>L("ai"),className:"flex-1 py-2 text-sm font-medium rounded-md transition-all flex items-center justify-center gap-2 ".concat("ai"===U?"bg-white text-purple-700 shadow-sm":"text-slate-500 hover:text-slate-700"),children:[(0,s.jsx)(D.Z,{size:14})," Import from Text"]})]}),"manual"===U?(0,s.jsxs)("form",{onSubmit:ep,className:"space-y-5",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Destination"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(k.Z,{className:"absolute left-3 top-3 text-slate-400",size:18}),(0,s.jsx)("input",{type:"text",required:!0,value:f.destination,onChange:e=>y({...f,destination:e.target.value}),className:"w-full pl-10 p-3 border border-slate-200 rounded-xl focus:ring-2 focus:ring-brand-500 outline-none",placeholder:"e.g. Tokyo, Paris"})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Start Date"}),(0,s.jsx)("input",{type:"date",required:!0,value:f.startDate,onChange:e=>y({...f,startDate:e.target.value}),className:"w-full p-3 border border-slate-200 rounded-xl focus:ring-2 focus:ring-brand-500 outline-none"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"End Date"}),(0,s.jsx)("input",{type:"date",required:!0,value:f.endDate,onChange:e=>y({...f,endDate:e.target.value}),className:"w-full p-3 border border-slate-200 rounded-xl focus:ring-2 focus:ring-brand-500 outline-none"})]})]}),(0,s.jsx)("div",{className:"pt-2",children:(0,s.jsxs)("button",{type:"button",onClick:eh,className:"text-xs text-purple-600 font-medium hover:underline flex items-center gap-1",children:[(0,s.jsx)(D.Z,{size:12}),' Load "Taipei 4 Days" Example']})}),(0,s.jsxs)("div",{className:"flex gap-3 mt-8",children:[(0,s.jsx)("button",{type:"button",onClick:()=>t("dashboard"),className:"flex-1 py-3 text-slate-600 font-medium hover:bg-slate-50 rounded-xl transition-colors",children:"Cancel"}),(0,s.jsx)("button",{type:"submit",className:"flex-1 py-3 bg-brand-600 text-white font-bold rounded-xl hover:bg-brand-700 transition-colors shadow-lg shadow-brand-200",children:"Start Planning"})]})]}):(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Paste your itinerary"}),(0,s.jsx)("textarea",{value:G,onChange:e=>B(e.target.value),placeholder:"Paste flight details, hotel info, or a full day-by-day plan here...",className:"w-full h-40 p-3 border border-slate-200 rounded-xl focus:ring-2 focus:ring-purple-200 outline-none resize-none text-sm"}),(0,s.jsx)("p",{className:"text-xs text-slate-500 mt-2",children:"The AI will extract dates, locations, and times automatically."})]}),(0,s.jsxs)("button",{onClick:()=>{B("\uD83C\uDDF9\uD83C\uDDFC 台北4日3夜美食之旅\n\n✈️航班：12/18 CX564 08:30 HKG→10:15 TPE / 12/21 CX565 19:30 TPE→21:30 HKG\n\uD83C\uDFE8住宿：D1慕舍酒店(D1) / D2麗禧溫泉(D2) / D3-4路徒Plus主題館\n\n\uD83D\uDCC5 Day1 12/18(四) 中山→華山→信義\n•10:15-12:00 軟食力行天宮店\n•12:15-13:00 慕舍酒店寄行李\n•13:30-15:30 華山1914文創\n... (Click Generate to see full parsing)")},className:"text-xs text-purple-600 font-medium hover:underline flex items-center gap-1",children:[(0,s.jsx)(D.Z,{size:12})," Use Taipei Text Example"]}),(0,s.jsxs)("button",{onClick:ep,disabled:q||!G,className:"w-full py-3 bg-purple-600 text-white font-bold rounded-xl hover:bg-purple-700 transition-colors shadow-lg shadow-purple-200 flex justify-center items-center gap-2",children:[q?(0,s.jsx)(j.Z,{className:"animate-spin"}):(0,s.jsx)(D.Z,{size:18}),"Generate from Text"]})]})]})});let ej=b.find(e=>e.dayId===d),eN="overview"===d?b.flatMap(e=>e.places):ej?ej.places:[],ew="overview"===d?b.map((e,t)=>({dayIndex:t,places:e.places})):void 0;return(0,s.jsxs)(n.LB,{sensors:ex,collisionDetection:n.ey,onDragStart:e=>{h(String(e.active.id))},onDragEnd:e=>{var t;let{active:a,over:s}=e;if(h(null),!s)return;let l=String(a.id),r=String(s.id),n=e=>{var t;return null===(t=b.find(t=>t.places.some(t=>t.id===e)))||void 0===t?void 0:t.dayId},d=n(l),o=n(r)||(null===(t=b.find(e=>e.dayId===r))||void 0===t?void 0:t.dayId);d&&o&&(d===o?g(e=>e.map(e=>{if(e.dayId===d){let t=e.places.findIndex(e=>e.id===l),a=e.places.findIndex(e=>e.id===r);return{...e,places:(0,i.Rp)(e.places,t,a)}}return e})):g(e=>{let t=e.find(e=>e.dayId===d),a=e.find(e=>e.dayId===o),s=t.places.find(e=>e.id===l),n=t.places.filter(e=>e.id!==l),i=a.places.findIndex(e=>e.id===r),c=[...a.places];return i>=0?c.splice(i,0,s):c.push(s),e.map(e=>e.dayId===d?{...e,places:n}:e.dayId===o?{...e,places:c}:e)}))},children:[X&&(0,s.jsxs)("div",{className:"fixed inset-0 z-[100] bg-black/50 flex flex-col items-center justify-center text-white backdrop-blur-sm",children:[(0,s.jsx)(D.Z,{className:"animate-spin mb-4 text-amber-400",size:48}),(0,s.jsx)("h3",{className:"text-2xl font-bold",children:"Optimizing Route..."}),(0,s.jsx)("p",{className:"text-white/80 mt-2",children:"The AI is finding the best path for you."})]}),(0,s.jsxs)("div",{className:"flex h-screen w-screen overflow-hidden bg-white",children:[(0,s.jsxs)("div",{className:"md:hidden fixed bottom-6 left-1/2 -translate-x-1/2 z-50 flex bg-white/90 backdrop-blur shadow-xl rounded-full p-1 border border-slate-200 gap-1 no-print",children:[(0,s.jsx)("button",{className:"p-3 rounded-full transition-all ".concat("list"===a?"bg-brand-600 text-white shadow-md":"text-slate-500 hover:bg-slate-100"),onClick:()=>r("list"),children:(0,s.jsx)(V.Z,{size:20})}),(0,s.jsx)("button",{className:"p-3 rounded-full transition-all ".concat("map"===a?"bg-brand-600 text-white shadow-md":"text-slate-500 hover:bg-slate-100"),onClick:()=>r("map"),children:(0,s.jsx)(W.Z,{size:20})})]}),(0,s.jsx)("div",{className:"\n            w-full md:w-[400px] lg:w-[450px] flex-shrink-0 h-full z-20 shadow-xl\n            ".concat("map"===a?"hidden md:block":"block","\n        "),children:(0,s.jsx)(J,{days:b,activeDayId:d,setActiveDayId:o,onAddPlace:e=>{g(t=>t.map(t=>t.dayId===d?{...t,places:[...t.places,e]}:t)),p([e.lat,e.lng])},onUpdatePlace:(e,t)=>{g(a=>a.map(a=>a.dayId===e?{...a,places:a.places.map(e=>e.id===t.id?t:e)}:a))},onDeletePlace:(e,t)=>{g(a=>a.map(a=>a.dayId===e?{...a,places:a.places.filter(e=>e.id!==t)}:a))},onPlaceClick:e=>{p([e.lat,e.lng]),m(e),r("map")},onAIPlan:e=>{g(e),e.length>0&&(o(e[0].dayId),e[0].places.length>0&&p([e[0].places[0].lat,e[0].places[0].lng]))},mapCenter:{lat:x[0],lng:x[1]},tripTitle:w,onUpdateTitle:ef,isSaving:Z,onOptimize:ev,onUndo:()=>{0!==S.length&&(g(S[S.length-1]),z(e=>e.slice(0,-1)))},canUndo:S.length>0,isEditMode:I,onToggleEditMode:()=>T(!I),onUpdateDayTitle:(e,t)=>{g(a=>a.map(a=>a.dayId===e?{...a,title:t}:a))},onBack:()=>{t("dashboard"),r("list")},onMoveDay:(e,t)=>{t<0||t>=b.length||g(a=>{let s=[...a],[l]=s.splice(e,1);return s.splice(t,0,l),s})},onShowStopovers:e=>$(e)})}),(0,s.jsx)("div",{className:"\n            flex-1 h-full relative z-0 bg-slate-100 map-container\n            ".concat("list"===a?"hidden md:block":"block","\n        "),children:(0,s.jsx)(ec,{places:eN,center:x,zoom:13,allPlaces:ew,isOverview:"overview"===d,stopoverCandidates:Q})})]}),(0,s.jsx)(n.y9,{children:u?(0,s.jsx)("div",{className:"opacity-90 scale-105",children:(0,s.jsx)("div",{className:"bg-white p-3 rounded shadow-xl border-l-4 border-brand-500 w-[350px]",children:"Moving item..."})}):null})]})}}},function(e){e.O(0,[850,971,117,744],function(){return e(e.s=8648)}),_N_E=e.O()}]);